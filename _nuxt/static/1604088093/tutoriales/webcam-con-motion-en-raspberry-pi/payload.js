__NUXT_JSONP__("/tutoriales/webcam-con-motion-en-raspberry-pi", (function(a,b,c,d,e,f,g,h,i,j,k){b.cdate="2019-04-01 00:00:00";b.mdate="2019-10-26 14:05:12";c[0]="migueabellan";return {data:[{tutorial:{alias:"webcam-con-motion-en-raspberry-pi",title:a,description:f,image:"img\u002Fpreview.jpg",contributors:c,tags:{technology:[d],hardware:[e],software:[],level:[k,g],others:[h,i]},extra:{level:"Medio",duration:"45 minutos",videos:j},date:b},title:a,description:f,image:"https:\u002F\u002Fraw.githubusercontent.com\u002FProgramoErgoSum\u002FTutoriales\u002Fmaster\u002Fv1\u002Fwebcam-con-motion-en-raspberry-pi\u002Fimg\u002Fpreview.jpg",date:b,tags:[d,e,k,g,h,i],editLink:"https:\u002F\u002Fgithub.com\u002FProgramoErgoSum\u002FTutoriales\u002Fedit\u002Fmaster\u002Fv1\u002Fwebcam-con-motion-en-raspberry-pi\u002FREADME.md",contributors:c,raw:"## Introducción\n\nEn este tutorial vamos a explicar cómo instalar y configurar motion para montar un sistema de videovigilancia.\n\n### Antes de empezar\n\nVas a necesitar los siguientes componentes:\n\n- Raspberry Pi con Raspbian\n- Webcam USB\n\nEs recomendable acceder a los siguientes tutoriales:\n\n- Configurar Webcam en Raspberry Pi\n\n\n\n\u003Cbr \u002F\u003E\n\n\n\n## Software Motion\n\n[Motion](https:\u002F\u002Fmotion-project.github.io) es uno de los programas más populares para utilizar con webcams, cuya utilidad es la de detectar movimientos. De esta forma podemos grabar momentos en los cuales se ha detectado movimiento. \n\n\n\n\u003Cbr \u002F\u003E\n\n\n\n## Instalar Motion\n\n\u003E Recuerda que antes de instalar un programa es recomendable actualizar Raspbian como se explica en el tutorial de actualizar Raspbian.  \n\nUna vez actualizada la lista de paquetes del repositorio, podemos instalar Motion mediante el comando `apt install motion`.\n\n```sh\npi@raspberrypi:~ $ sudo apt install motion\n```\n\n\n\n\u003Cbr \u002F\u003E\n\n\n\n## Arrancar Motion\n\nEn este caso vamos a configurar el fichero de configuración encargado de habilitar el daemon de Motion al iniciar la Raspberry Pi. Para ello accedemos al fichero `\u002Fetc\u002Fdefault\u002Fmotion`. Para abrirlo de una forma sencilla y con privilegios de administrador introducimos el comando `sudo leafpad \u002Fetc\u002Fdefault\u002Fmotion`.\n\n```sh\npi@raspberrypi:~ $ sudo leafpad \u002Fetc\u002Fdefault\u002Fmotion\n```\n\n```\n# set to 'yes' to enable the motion daemon\nstart_motion_daemon=yes\n```\n\nPor último, reseteamos el servicio con el comando `service motion restart` para que los cambios tengan efecto y una vez reiniciado el servicio ya podemos acceder a través de la dirección `localhost:8081`.\n\n```sh\npi@raspberrypi:~ $ sudo service motion restart\n```\n\nPara comprobar que se ha instalado correctamente, abrimos un navegador en la misma Raspberry Pi, accedemos a la dirección `localhost:8081` y se debe ver la webcam.\n\n![](img\u002Fmotion.jpg \"Motion\")\n\n\n\n\u003Cbr \u002F\u003E\n\n\n\n## Configuración (solo para módulo PICAM)\n\nSolo si dispones de un módulo PICAM deberás activar el driver que haga funcionar el programa motion. En caso de disponer de una webcam omite esta sección.\n\n```sh\npi@raspberrypi:~ $ sudo modprobe bcm2835-v4l2\n```\n\nAñadimos el módulo de PICAM.\n\n```sh\npi@raspberrypi:~ $ sudo leafpad \u002Fetc\u002Fmodules\n```\n\n```\n# añadir al final del fichero\nbcm2835-v4l2\n```\n\nReinicia el sistema antes de continuar con el siguiente paso.\n\n\n\n\u003Cbr \u002F\u003E\n\n\n\n## Acceder a Motion de forma remota\n\nProbablemente lo que nos interese sea ver el contenido de la webcam desde fuera de la Raspberry Pi, por ejemplo, para controlar un bebe desde otra habitación. Para ello vamos a configurar Motion para que nos permita acceder desde la propia red local.\n\nEn primer lugar accedemos al fichero `\u002Fetc\u002Fmotion\u002Fmotion.conf` donde aparecen todas las opciones de configuración de Motion. Para abrirlo de una forma sencilla y con privilegios de administrador introducimos el comando `sudo leafpad \u002Fetc\u002Fmotion\u002Fmotion.conf`.\n\n```sh\npi@raspberrypi:~ $ sudo leafpad \u002Fetc\u002Fmotion\u002Fmotion.conf\n```\n\nVamos a indicar en el fichero de configuración que el software arranque como servicio. Para ello cambiamos el valor `daemon on`. También debemos especificar el puerto web por el cual veremos nuestra webcam y que no solamente se va a reproducir en modo local sino que además debemos permitir el acceso desde fuera de la red local.\n\n\u003E Como se puede observar, en este fichero aparecen diferentes configuración por defecto, y a medida que vayamos teniendo experiencia podemos ir probando.\n\n```\n# Start in daemon (background) mode and release terminal (default: off)\ndaemon on\n\n# The mini-http server listens to this port for requests (default: 0 = disabled)\nstream_port 8081\n\n# Restrict stream connections to localhost only (default: on)\nstream_localhost off\n```\n\nVolvemos a resetear el servicio con el comando `service motion restart` para que los cambios tengan efecto y una vez reiniciado el servicio ya podemos acceder desde otro dispositivo conectado a la misma red local a través de la dirección `\u003CIP\u003E:8081`.\n\n```sh\npi@raspberrypi:~ $ sudo service motion restart\n```\n\n![](img\u002Fremoto.jpg \"Acceso remoto\")\n\n\n\n\u003Cbr \u002F\u003E\n\n\n\n## Detectar movimientos\n\nPor defecto, Motion guarda en imagen y vídeo cualquier evento que ocurra delante de la webcam y lo guarda en el directorio `\u002Fvar\u002Flib\u002Fmotion`. Estos ajustes podemos modificarlos en el fichero de onfiguración.\n\n```sh\npi@raspberrypi:~ $ sudo leafpad \u002Fetc\u002Fmotion\u002Fmotion.conf\n```\n\n```\n# Output 'normal' pictures when motion is detected (default: on)\noutput_pictures on\n\n# Recommended to use absolute path. (Default: current working directory)\ntarget_dir \u002Fvar\u002Flib\u002Fmotion\n```\n\n![](img\u002Fcapturas.jpg \"Detectar movimientos\")\n\nRecuerda que al cambiar parámetros del fichero de configuración deberás reiniciar el servicio motion con el comando `sudo service motion restart`.\n\n```sh\npi@raspberrypi:~ $ sudo service motion restart\n```\n\nUna vez reiniciado el sistema podemos acceder a la carpeta `\u002Fvar\u002Flib\u002Fmotion` y veremos todas las imágenes detectadas por la webcam.\n\nLas imágenes son almacenadas mediante el usuario `motion`, con lo cual para poder eliminarlas con nuestro usuario `pi` tendremos que añadirle permiso a la carpeta utilizando el siguiente comando.\n\n```sh\n$ sudo chmod -R 777 \u002Fvar\u002Flib\u002Fmotion\u002F\n```\n\nPor último, recuerda parar el servicio para que no esté almacenando fotos en todo momento. Para ello deberás utilizar el siguiente comando.\n\n```sh\npi@raspberrypi:~ $ sudo service motion stop\n```\n\nComprueba que deja de verse la webcam a través del navegador una vez parado el servicio.\n\n\n\n\u003Cbr \u002F\u003E\n\n\n\n## Ejercicios propuestos\n\n1.- Conecta una webcam USB e instala y configura Motion correctamente.\n\n2.- Accede desde un dispositivo móvil en la misma red para comprobar que puedes ver la webcam desde el móvil.\n\n3.- Deshabilita la captura de movimiento y grabación automática en Motion.\n",cdn:"https:\u002F\u002Fraw.githubusercontent.com\u002FProgramoErgoSum\u002FTutoriales\u002Fmaster\u002Fv1\u002Fwebcam-con-motion-en-raspberry-pi\u002F",breadcrumbs:[{text:"Tutoriales",disabled:false,to:"\u002Ftutoriales"},{text:a,disabled:true,to:j}]}],fetch:[],mutations:[]}}("Detecta movimientos con una webcam y Motion en Raspberry Pi",{},Array(1),"Informática","Raspberry Pi","Con Motion podrás detectar movimientos utilizando una webcam en tu Raspberry Pi.","Bachillerato","Raspbian","Webcam","","Secundaria")));